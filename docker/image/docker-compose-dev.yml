# sudo docker-compose -p aeon_dev --verbose -f docker/image/docker-compose-dev.yml up --build --force-recreate --remove-orphans -d
# sudo docker-compose -p aeon_dev -f docker/image/docker-compose-dev.yml down --volumes
# export CID=$(sudo docker ps -aqf name=aeon_dev)
# sudo docker exec -it $CID bash
# sudo docker exec -it $CID conda-run python
version: "2.4"

services:
  aeon_dev:
    environment:
      DJ_USER: ${DJ_USER:-root}
      DJ_PASS: ${DJ_PASS:-simple}
      DJ_HOST: ${DJ_HOST:-host.docker.internal}
    image: aeon_mecha:v0.0.0dev
    build:
      context: ../../.
      dockerfile: docker/image/Dockerfile
      args:
        NEW_USER_UID: ${NEW_USER_UID:-6001}
        NEW_USER_GID: ${NEW_USER_GID:-6001}
    volumes:
      - "${LOCAL_CEPH_ROOT:-~/ceph/aeon}:/ceph/aeon"
      - "${LOCAL_DJ_STORE:-~/ceph/aeon/aeon/dj_store}:/ceph/aeon/aeon/dj_store"
      - "../../.:/home/aeon_db/aeon_mecha"
      - "vscode-server-dir:/home/aeon_db/.vscode-server/extensions"
    extra_hosts:
      - host.docker.internal:host-gateway
    init: true
    tty: true
    user: aeon_db:condauser
    entrypoint: ["/bin/bash", "-lc"]
    command: "tail -f /dev/null"

volumes:
  vscode-server-dir:
